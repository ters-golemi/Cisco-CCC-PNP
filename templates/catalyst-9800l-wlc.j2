{# Cisco Catalyst 9800-L WLC Configuration Template #}
{# Wireless LAN Controller Configuration - Catalyst Center 3.1.x Compatible #}
{# Device: {{ device.name }} #}

version 17.06.01
service timestamps debug datetime msec
service timestamps log datetime msec
service call-home
!
hostname {{ device.name }}
!
! System Configuration for 3.1.x compatibility
clock timezone {{ device.timezone | default('UTC') }} 0 0
!
! NTP configuration for 3.1.x certificate validation
ntp server {{ ntp_server | default('172.16.1.1') }}
ntp server {{ ntp_server_backup | default('pool.ntp.org') }}
!
boot system flash bootflash:cat9k_lite_iosxe.17.06.01.SPA.bin
!
! License Configuration
license boot level network-advantage addon dna-advantage
!
! Memory Configuration
memory free low-watermark processor 72329
!
! Enable enhanced services for 3.1.x
no ip http server
ip http secure-server
ip http max-connections 16
ip http client source-interface {{ device.mgmt_interface | default('GigabitEthernet0/0/0') }}
!
! Enhanced NETCONF/RESTCONF for 3.1.x wireless management
netconf-yang
netconf-yang cisco-odm polling-enable
netconf max-sessions 16
restconf
!
! Management Users (3.1.x credential requirements)
username admin privilege 15 secret 5 $1$mERr$hx5rVt7rPNoS4wqbXKX7m0
username dnac privilege 15 secret 5 $1$mERr$hx5rVt7rPNoS4wqbXKX7m0
!
! SNMP configuration for 3.1.x wireless monitoring
snmp-server community {{ snmp.read_community | default('cisco123') }} RO
snmp-server community {{ snmp.write_community | default('cisco123') }} RW
snmp-server location {{ device.location | default('Wireless Lab') }}
snmp-server contact {{ device.contact | default('Wireless Admin') }}
!
! VRF Configuration for management isolation
vrf definition Mgmt-vrf
 !
 address-family ipv4
 exit-address-family
!
! SSH Configuration
ip domain-name {{ topology.catalyst_center.settings.domain }}
crypto key generate rsa general-keys modulus 2048
ip ssh version 2
!

! Interface Configuration
interface GigabitEthernet0/0/0
 description "Management Interface"
 vrf forwarding Mgmt-vrf
 ip address {{ device.mgmt_ip }} 255.255.255.0
 negotiation auto
 no shutdown
!

! Trunk Interface to Core Switch
interface TenGigabitEthernet0/1/0
 description "Trunk to Core Switch"
 switchport mode trunk
 switchport trunk allowed vlan {{ device.trunk_vlans | join(',') }}
 no shutdown
!

! Management VLAN Interface
interface Vlan1
 description "Management VLAN"
 ip address {{ device.mgmt_vlan_ip }} 255.255.255.0
 no shutdown
!

! Wireless Management Interface
interface Vlan70
 description "Wireless Management"
 ip address {{ device.wireless_mgmt_ip }} 255.255.255.0
 no shutdown
!

! Default Gateway
ip route vrf Mgmt-vrf 0.0.0.0 0.0.0.0 {{ topology.gateways.mgmt_gateway }}
ip route 0.0.0.0 0.0.0.0 {{ topology.gateways.default }}
!

! Wireless Configuration
! AP Manager Interface
wireless management interface Vlan70
!
! Country Code
wireless country US
!
! Mobility Configuration
wireless mobility controller
wireless mobility group name {{ topology.wireless.mobility_group }}
wireless mobility group member ip {{ device.mgmt_ip }} public-ip {{ device.mgmt_ip }}
!

! Policy Tags
wireless tag policy CORPORATE_POLICY
 wlan CORPORATE_WLAN shutdown
 no wlan CORPORATE_WLAN shutdown
!
wireless tag policy GUEST_POLICY
 wlan GUEST_WLAN shutdown
 no wlan GUEST_WLAN shutdown
!

! Site Tags
wireless tag site SITE_TAG
 ap-profile default-ap-profile
 policy-profile default-policy-profile
 rf-profile default-rf-profile
!

! WLAN Definitions
wlan CORPORATE_WLAN 10 CORPORATE_WLAN
 client vlan {{ topology.vlans | selectattr('name', 'equalto', 'corporate') | map(attribute='vlan_id') | first }}
 no security wpa akm dot1x
 no security wpa wpa2
 security wpa wpa2 ciphers aes
 security wpa akm psk set-key ascii 0 CorporateWiFi123!
 no shutdown
!
wlan GUEST_WLAN 40 GUEST_WLAN
 client vlan {{ topology.vlans | selectattr('name', 'equalto', 'guest') | map(attribute='vlan_id') | first }}
 no security wpa akm dot1x
 no security wpa wpa2
 security wpa wpa2 ciphers aes
 security wpa akm psk set-key ascii 0 GuestWiFi123!
 no shutdown
!

! Policy Profiles
wireless profile policy default-policy-profile
 vlan {{ topology.vlans | selectattr('name', 'equalto', 'corporate') | map(attribute='vlan_id') | first }}
 no shutdown
!

! AP Profile
wireless profile ap default-ap-profile
 hyperlocation ble-beacon 0
 hyperlocation ble-beacon 1
 hyperlocation ble-beacon 2
 hyperlocation ble-beacon 3
 hyperlocation ble-beacon 4
!

! RF Profile (Radio Frequency)
wireless profile rf default-rf-profile
 band 2.4ghz
  channel width 20
  dca channels 1 6 11
  tx-power min 8 max 30
 band 5ghz
  channel width 80
  dca channels 36 40 44 48 52 56 60 64 100 104 108 112 116 120 124 128 132 136 140 144 149 153 157 161 165
  tx-power min 8 max 30
!

! Flex Profile for APs
wireless profile flex default-flex-profile
 description "Default FlexConnect Profile"
 vlan 10 name CORPORATE
 vlan 40 name GUEST
 native-vlan-id 1
!

! AP Groups for management
ap group default-group
 rf-profile default-rf-profile
 ap-profile default-ap-profile
!

! RADIUS Configuration for 802.1X
radius server ISE
 address ipv4 {{ topology.radius.server_ip }} auth-port 1812 acct-port 1813
 key {{ topology.radius.shared_secret }}
!
aaa group server radius ISE_GROUP
 server name ISE
!

! AAA Configuration
aaa new-model
aaa authentication login default local
aaa authorization exec default local
aaa accounting exec default start-stop group ISE_GROUP
!

! SNMP Configuration
snmp-server community public RO
snmp-server community private RW
snmp-server location "{{ device.location }}"
snmp-server contact "Network Admin"
snmp-server host {{ topology.catalyst_center.ip_address }} version 2c public
!

! Prime Infrastructure Integration
wireless fabric control-plane
ip address {{ topology.catalyst_center.ip_address }}
username {{ topology.catalyst_center.settings.username }} password {{ topology.catalyst_center.settings.password }}
!

! DHCP Pool for APs
ip dhcp pool AP_POOL
 network {{ topology.vlans | selectattr('name', 'equalto', 'ap_mgmt') | map(attribute='network') | first }}
 default-router {{ topology.vlans | selectattr('name', 'equalto', 'ap_mgmt') | map(attribute='gateway') | first }}
 dns-server {{ topology.dns.primary }} {{ topology.dns.secondary }}
 option 43 hex {{ topology.catalyst_center.settings.dhcp_option_43 }}
!

! Time Configuration
ntp server 0.pool.ntp.org
ntp server 1.pool.ntp.org
!

! Logging
logging buffered 16384 informational
logging console warnings
logging host {{ topology.catalyst_center.ip_address }}
!

! QoS Configuration for Wireless
class-map match-any VOICE_WIRELESS
 match dscp ef
!
class-map match-any VIDEO_WIRELESS
 match dscp af41
!
policy-map WIRELESS_QOS
 class VOICE_WIRELESS
  priority percent 30
 class VIDEO_WIRELESS
  bandwidth percent 25
 class class-default
  fair-queue
!

! Apply QoS to wireless VLANs
interface Vlan10
 service-policy output WIRELESS_QOS
!
interface Vlan40
 service-policy output WIRELESS_QOS
!

! High Availability (if applicable)
redundancy
 mode sso
!

! Archive for configuration management
archive
 log config
  logging enable
  notify syslog contenttype plaintext
 path bootflash:config-archive
 write-memory
!

! Line Configuration
line con 0
 logging synchronous
 exec-timeout 30 0
line aux 0
line vty 0 15
 exec-timeout 30 0
 transport input ssh
!

! Security Configuration
ip access-list extended WIRELESS_ACL
 permit udp any any eq domain
 permit tcp any any eq domain
 permit udp any any eq bootpc
 permit udp any any eq bootps
 permit tcp any any eq www
 permit tcp any any eq 443
 permit icmp any any echo
 permit icmp any any echo-reply
 deny ip any 10.10.70.0 0.0.0.255
 permit ip any any
!

! Wireless Security
wireless wps cred-check disable
wireless wps ap-authentication
!

! End of configuration
end